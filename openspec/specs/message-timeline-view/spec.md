## ADDED Requirements

### Requirement: Timeline Screen Layout

認証済みメイン画面は、メッセージリスト領域と下部入力エリアで構成される Slack 風タイムラインレイアウトを提供しなければならない（MUST）。

#### Scenario: メイン画面の基本構造

- **WHEN** 認証済みユーザーがメイン画面を表示する
- **THEN** メッセージリスト領域が表示される
- **AND** 画面下部に入力エリアが表示される

#### Scenario: メッセージリスト領域のスクロール

- **WHEN** 画面に表示可能な件数を超えるメッセージが存在する
- **THEN** メッセージリスト領域は上方向へスクロール可能である

### Requirement: Timeline Data Fetch and Rendering

システムは画面表示時に `GET /api/messages` で取得したメッセージ一覧を描画しなければならない（MUST）。

#### Scenario: 一覧取得の成功

- **WHEN** メイン画面を初回表示する
- **THEN** `/api/messages` への GET リクエストが送信される
- **AND** 取得した順序でメッセージが表示される

#### Scenario: メッセージ表示内容

- **WHEN** メッセージがタイムラインに描画される
- **THEN** 各メッセージに本文が表示される
- **AND** 各メッセージに投稿時刻が表示される

### Requirement: URL Auto-Linkification

システムはメッセージ本文中の URL を検出し、クリック可能なリンクとして表示しなければならない（MUST）。

#### Scenario: URL を含む本文

- **WHEN** `https://example.com` のような URL を含むメッセージを表示する
- **THEN** URL 部分がアンカータグとして描画される
- **AND** ユーザーがリンクをクリックできる

#### Scenario: URL を含まない本文

- **WHEN** URL を含まないメッセージを表示する
- **THEN** 通常テキストとして描画される

### Requirement: Initial Scroll Position

システムは初回表示時にタイムラインを最新メッセージまでスクロールし、表示完了時点で最新メッセージを表示領域に含めなければならない（MUST）。

#### Scenario: 初回表示時のスクロール

- **WHEN** メッセージ一覧の描画が完了する
- **THEN** タイムラインの表示位置は最新メッセージまで移動する
- **AND** 最新メッセージが表示領域に含まれる

#### Scenario: レイアウト更新後も最新メッセージを維持する

- **WHEN** 初回表示直後に日付セパレーター等のレイアウト反映で高さが変化する
- **THEN** タイムライン表示位置は最新メッセージを含む状態に調整される

### Requirement: Responsive Timeline View

システムはスマホ幅と PC 幅の両方で可読性を維持したレイアウトを提供しなければならない（MUST）。

#### Scenario: スマホ幅での表示

- **WHEN** ビューポート幅がスマホ相当（例: 375px 前後）でメイン画面を表示する
- **THEN** メッセージ本文・時刻・入力エリアが横スクロールなしで読める

#### Scenario: PC 幅での表示

- **WHEN** ビューポート幅が PC 相当（例: 1280px 前後）でメイン画面を表示する
- **THEN** タイムラインが余白を保って表示される
- **AND** メッセージ本文と時刻が判読しやすい配置を維持する

### Requirement: Timeline Date Separator Rendering

システムはメッセージタイムラインにおいて、日付（年・月・日）が切り替わる位置にのみ日付セパレーターを表示しなければならない（MUST）。  
セパレーター日付は言語設定に依存せず固定 `yyyy/MM/dd` 形式で表示しなければならない（MUST）。

#### Scenario: 日付が切り替わる位置でセパレーターを表示する

- **WHEN** タイムラインに `2025-01-16T23:59:00+09:00` と `2025-01-17T00:01:00+09:00` のように日付が異なる連続メッセージが表示される
- **THEN** それぞれの日付グループ先頭に対応する日付セパレーターが表示される
- **AND** セパレーター表示は `yyyy/MM/dd` 形式（例: `2025/01/16`）である

#### Scenario: 同一日付の連続メッセージ間ではセパレーターを重複表示しない

- **WHEN** 同じ日付（例: `2025-01-16`）に属するメッセージが連続して表示される
- **THEN** その日付グループ内で日付セパレーターは 1 回のみ表示される

#### Scenario: メッセージが存在しない日付を補間表示しない

- **WHEN** `2025-01-16` の次のメッセージが `2025-01-18` であり `2025-01-17` にメッセージが存在しない
- **THEN** `2025/01/17` の日付セパレーターは表示されない
- **AND** 表示されるのは実際にメッセージが存在する日付グループのセパレーターのみである

#### Scenario: ロケールが異なっても日付書式は固定される

- **WHEN** クライアントの言語設定が日本語または英語でタイムラインを表示する
- **THEN** 日付セパレーターは `2025/01/16` のような固定 `yyyy/MM/dd` 形式で表示される
- **AND** `2025年1月16日` や `01/16/2025` のようなロケール依存形式は使用されない

### Requirement: Timeline Message Composer Layout

認証済みメイン画面は、画面下部に固定配置されたメッセージ入力欄と送信ボタンを提供しなければならない（MUST）。

#### Scenario: 入力エリアの基本構造

- **WHEN** 認証済みユーザーがタイムライン画面を表示する
- **THEN** 画面下部にテキスト入力欄が表示される
- **AND** 送信ボタンが表示される

### Requirement: Timeline Message Submission Interaction

システムはメッセージ入力欄で Enter による改行と Ctrl+Enter による送信を区別して処理しなければならない（MUST）。

#### Scenario: Enter で改行する

- **WHEN** 入力欄に本文を入力した状態で Enter キーを押す
- **THEN** 本文に改行が追加される
- **AND** `POST /api/messages` の送信処理は実行されない

#### Scenario: Ctrl+Enter で送信する

- **WHEN** 入力欄に本文を入力した状態で Ctrl+Enter キーを押す
- **THEN** `POST /api/messages` への送信処理が実行される

### Requirement: Post-Submit Timeline Update

システムはメッセージ送信成功時、入力欄をクリアし、作成されたメッセージをタイムラインに反映したうえで、追加されたそのメッセージまでスクロールしなければならない（MUST）。

#### Scenario: 送信成功後の UI 更新

- **WHEN** `POST /api/messages` が成功レスポンスを返す
- **THEN** 入力欄の値は空文字にリセットされる
- **AND** 作成されたメッセージがタイムラインへ追加表示される
- **AND** タイムライン表示位置は追加されたメッセージまで移動する

#### Scenario: 新規追加メッセージより手前でスクロールが止まらない

- **WHEN** 送信成功でメッセージが 1 件追加される
- **THEN** 追加前の末尾メッセージではなく、追加された最新メッセージが表示領域に含まれる

### Requirement: Empty Message Submission Guard

システムは空テキストのメッセージ送信を実行してはならない（MUST NOT）。

#### Scenario: 空テキスト時の送信抑止

- **WHEN** 入力欄が空文字の状態で送信操作を行う
- **THEN** `POST /api/messages` リクエストは送信されない

### Requirement: Message Edit Action Menu

システムは各メッセージ項目に編集操作を開始するメニュー導線を提供しなければならない（MUST）。

#### Scenario: メッセージ操作メニューから編集を選択する

- **WHEN** ユーザーが任意のメッセージ行で操作メニュー（例: `...` ボタン）を開く
- **THEN** メニュー内に「編集」操作が表示される
- **AND** 「編集」を選択すると対象メッセージが編集モードへ切り替わる

### Requirement: Inline Message Edit Mode

システムは編集対象メッセージをインライン編集モードで表示しなければならない（MUST）。

#### Scenario: 編集開始時の表示切り替え

- **WHEN** メッセージで「編集」を選択する
- **THEN** 対象メッセージ本文はテキストエリアへ切り替わる
- **AND** 「保存」ボタンと「キャンセル」ボタンが表示される

### Requirement: Message Edit Save Behavior

システムはインライン編集の保存操作時に `PUT /api/messages/:id` を呼び出し、成功時はタイムライン表示を更新しなければならない（MUST）。

#### Scenario: 保存成功時に本文表示が更新される

- **WHEN** 編集中メッセージの保存操作が成功レスポンスを受け取る
- **THEN** 対象メッセージは更新済み本文で表示される
- **AND** 編集モードは終了する

#### Scenario: 保存失敗時は編集内容を保持する

- **WHEN** 保存操作が失敗レスポンスまたは通信失敗になる
- **THEN** 編集中の入力内容は保持される
- **AND** ユーザーが再試行できるエラー表示が行われる

### Requirement: Message Edit Cancel Behavior

システムは編集キャンセル時にインライン編集を終了し、更新 API を呼び出してはならない（MUST NOT）。

#### Scenario: キャンセルで元の表示へ戻る

- **WHEN** 編集中メッセージで「キャンセル」を押す
- **THEN** 編集モードが終了して通常表示へ戻る
- **AND** `PUT /api/messages/:id` リクエストは送信されない

### Requirement: Message Delete Action Menu

システムは各メッセージ項目の操作メニューに削除導線を提供しなければならない（MUST）。

#### Scenario: 操作メニューに削除を表示する

- **WHEN** ユーザーが任意のメッセージ行で操作メニューを開く
- **THEN** メニュー内に「削除」操作が表示される

### Requirement: Message Delete Confirmation Dialog

システムは削除実行前に確認ダイアログを表示し、ユーザー確認なしに削除を確定してはならない（MUST NOT）。

#### Scenario: 削除選択時に確認ダイアログを表示する

- **WHEN** ユーザーがメッセージの「削除」を選択する
- **THEN** 「このメッセージを削除しますか？」という確認ダイアログが表示される

### Requirement: Confirmed Message Delete Execution

システムは確認ダイアログで削除を承認した場合のみ `DELETE /api/messages/:id` を呼び出し、成功時にタイムラインから対象メッセージを除去しなければならない（MUST）。

#### Scenario: 確認ダイアログで OK を選択する

- **WHEN** ユーザーが確認ダイアログで「OK」を選択する
- **THEN** `DELETE /api/messages/:id` が送信される
- **AND** 削除成功後に対象メッセージがタイムラインから消える

### Requirement: Message Delete Cancel Behavior

システムは確認ダイアログでキャンセルされた場合、削除 API を呼び出してはならず、表示内容を変更してはならない（MUST NOT）。

#### Scenario: 確認ダイアログでキャンセルを選択する

- **WHEN** ユーザーが確認ダイアログで「キャンセル」を選択する
- **THEN** `DELETE /api/messages/:id` リクエストは送信されない
- **AND** 対象メッセージはタイムラインに残る

### Requirement: Compact Message Action Menu Layout

システムは通常表示の各メッセージ項目において、編集・削除の操作メニュー導線を維持しつつ、メニュー導線のためだけの専用1行を確保してはならない（MUST NOT）。

#### Scenario: 通常表示で本文の前に専用空行を作らない

- **WHEN** ユーザーがタイムライン上のメッセージ項目（非編集モード）を表示する
- **THEN** メッセージ本文はメッセージカード上端から読める位置に表示される
- **AND** 操作メニュートリガーは同じメッセージカード内で表示される
- **AND** メニュー導線表示のためだけの空行領域は表示されない

#### Scenario: モバイル幅と PC 幅でコンパクト配置を維持する

- **WHEN** ビューポート幅がスマホ相当（例: 375px 前後）または PC 相当（例: 1280px 前後）でタイムラインを表示する
- **THEN** どちらの幅でもメッセージ本文の上部に専用空行領域は表示されない
- **AND** 操作メニュートリガーから編集・削除メニューを開ける

### Requirement: Message Copy Action Menu

システムは各メッセージ項目の操作メニューに、既存の編集・削除導線を維持したまま「コピー」導線を提供しなければならない（MUST）。

#### Scenario: 操作メニューにコピーを表示する

- **WHEN** ユーザーが任意のメッセージ行で操作メニューを開く
- **THEN** メニュー内に「コピー」操作が表示される
- **AND** 同じメニュー内に既存の「編集」と「削除」操作も表示される

### Requirement: Message Body Clipboard Copy

システムはユーザーがメッセージの「コピー」を選択したとき、対象メッセージ本文を `navigator.clipboard.writeText(body)` でクリップボードへ書き込まなければならない（MUST）。

#### Scenario: コピー操作で本文を書き込む

- **WHEN** ユーザーが本文を含むメッセージで「コピー」を選択する
- **THEN** システムは対象メッセージ本文を引数として `navigator.clipboard.writeText` を呼び出す

### Requirement: Clipboard Copy Completion Feedback

システムはクリップボードコピー成功時に、対象メッセージでコピー完了を示す視覚フィードバック（アイコン変化）を即時表示しなければならない（MUST）。

#### Scenario: コピー成功時にアイコン変化を表示する

- **WHEN** メッセージ本文のクリップボード書き込みが成功する
- **THEN** 対象メッセージでコピー完了を示すアイコン変化が表示される
