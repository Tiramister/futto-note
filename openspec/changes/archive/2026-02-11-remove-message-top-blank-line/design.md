## Context

現状の `MessageList` は、通常表示のメッセージ項目で `message-header` 行を先頭に置き、その中に `...` メニュートリガーだけを配置している。  
この構造により本文より前に常時 1 行分の領域が確保され、各メッセージの上部に不要な空きが見える。

本 change は `message-timeline-view` の表示要件として、操作メニュー導線を維持したまま、通常表示時の不要な上部空行をなくすことを目的とする。  
変更対象はフロントエンドのマークアップと CSS に限定し、API・データモデルは変更しない。

## Goals / Non-Goals

**Goals:**
- 通常表示のメッセージ項目から「メニューのためだけの専用ヘッダー行」を廃止する。
- メッセージ本文がカード上端から自然に読み始められるレイアウトにする。
- 編集・削除メニューの導線と操作挙動を維持する。
- スマホ幅/PC幅の双方で、本文の可読性とメニューのタップ/クリックしやすさを維持する。

**Non-Goals:**
- メッセージ編集/削除 API の仕様変更。
- メッセージ本文の整形ルール（URL 自動リンク化など）の変更。
- タイムライン全体レイアウトや日付セパレーター仕様の変更。
- 新しい UI コンポーネントライブラリや外部依存の導入。

## Decisions

### 1. メニュー専用のヘッダー行を削除し、メニュー導線はメッセージカード内に再配置する

- 決定: `message-header` を廃止し、`message-menu` をメッセージ項目内に直接配置することで、先頭の不要な 1 行をなくす。
- 理由: 空行の根本原因が DOM 構造にあるため、余白調整だけではなく構造自体を簡素化するのが最も確実。
- 代替案: `message-header` を残したまま高さやマージンだけ削る方式は、再調整で空行が再発しやすく不採用。

### 2. メニュー導線は「本文と視覚的に重ならない」配置を優先する

- 決定: `...` トリガーはカード右上に置くが、本文領域と重ならないようカード内余白と配置ルールをセットで定義する。
- 理由: 空行を消しつつ既存の導線位置（右上）を維持でき、視線移動と発見性を落とさない。
- 代替案: メニューを本文末尾や時刻行に移す方式は、既存の操作位置の学習コストが増えるため不採用。

### 3. 既存の編集・削除フローを回帰させないため、表示回帰テストを更新する

- 決定: `MessageList` / `App` のテストを、メニュー導線が維持されることと本文表示が崩れないことを中心に更新する。
- 理由: この change は見た目中心だが、メニュー起点の編集/削除フローに直結するため、動作回帰の検知が必要。
- 代替案: 目視確認のみで対応する方式は、将来の CSS 変更での退行検知が弱いため不採用。

## Risks / Trade-offs

- [Risk] メニューの再配置により本文 1 行目と操作ボタンが重なる  
  → Mitigation: メニュー位置に応じた余白ルールを定義し、長文・短文の両ケースをテストで確認する。
- [Risk] レスポンシブ境界でメニュータップ領域が狭くなる  
  → Mitigation: 既存の最小タップ領域を維持し、モバイル幅のテストでクリック可能性を確認する。
- [Trade-off] マークアップ簡素化と引き換えに、CSS 側の配置責務がやや増える  
  → CSS クラス責務を明確化し、`MessageList.tsx` 側の構造は最小変更に留める。

## Migration Plan

1. `MessageList.tsx` の通常表示マークアップを更新し、メニュー専用ヘッダー行を廃止する。
2. `App.css` の `message-item` / `message-menu` 関連スタイルを更新して、空行なく表示できるようにする。
3. `MessageList.test.tsx` と `App.test.tsx` を更新し、編集/削除導線が維持されることを確認する。
4. フロントエンドをデプロイし、表示崩れがあれば CSS 変更をロールバックする（API/DB 影響なし）。

## Open Questions

- `...` トリガーの常時表示を維持するか、ホバー時強調に寄せるかは今後の UI 改善で検討可能。今回の change では常時表示のまま配置のみ改善する。
