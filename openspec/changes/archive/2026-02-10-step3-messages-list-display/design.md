## Context

Step 2 まででセッション認証とログイン画面は実装済みであり、認証済みユーザーを判定する基盤は揃っている。一方でノート本文を閲覧する API と UI が未実装のため、ユーザーは保存済みデータを確認できない。

本 change では `messages` テーブルを読み取る `GET /api/messages` と、取得結果を表示するタイムライン UI を追加する。`docs/future-spec.md` で将来検討とされているページネーションは現時点では導入せず、まずは全件取得で MVP の閲覧体験を成立させる。

## Goals / Non-Goals

**Goals:**
- 認証済みユーザー向けに `GET /api/messages` を提供し、`created_at` 昇順の一覧レスポンスを返す
- フロントエンドでメッセージ一覧を取得し、本文・投稿時刻をタイムライン表示する
- URL 自動リンク化、初回最下部スクロール、スマホ/PC のレスポンシブ表示を実現する

**Non-Goals:**
- メッセージ追加・編集・削除の実装（Step 5 以降で対応）
- 日付セパレーター表示（Step 4 で対応）
- ページネーションや無限スクロール（将来対応）
- Markdown レンダリング対応

## Decisions

### 1. 一覧 API は既存認証ミドルウェアを再利用する

**決定**:
- `GET /api/messages` は Step 2 で導入済みの認証ミドルウェア配下に配置する
- ハンドラーはコンテキストから `user_id` を取得し、`messages` テーブルをユーザー単位で検索する

**理由**:
- 認証ロジックの重複を避け、401 の挙動を既存 API と統一できる
- 将来のメッセージ系 API（POST/PUT/DELETE）と同じ保護境界を維持できる

**代替案**:
- ハンドラー内で都度セッション検証する方法は実装重複が大きいため不採用

### 2. SQL とレスポンス形式を Step 3 要件に固定する

**決定**:
- クエリは `SELECT id, body, created_at FROM messages WHERE user_id = $1 ORDER BY created_at ASC` を採用する
- レスポンスは `{ "messages": [...] }` 形式に統一し、空データ時は `[]` を返す

**理由**:
- Slack 風 UI の時系列表示と整合する
- API 形式を固定することで後続 Step（追加・編集・削除）の画面更新ロジックを単純化できる

**代替案**:
- DESC 取得後にフロントで反転する案は、責務が分散して読みやすさが落ちるため不採用

### 3. URL 自動リンク化はフロントエンドで実施する

**決定**:
- バックエンドは本文テキストをそのまま返却し、リンク化は React 側で行う
- 実装は軽量な文字列解析（正規表現ベース）を優先し、新規依存は導入しない

**理由**:
- API をプレーンテキストのまま保てるため、他クライアント追加時の再利用性が高い
- 現段階では要件が単純であり、外部ライブラリ追加は過剰

**代替案**:
- linkify ライブラリ導入は精度向上の余地があるが、依存追加コストのため現時点では見送る

### 4. 初回最下部スクロールは描画完了後に 1 回実行する

**決定**:
- メッセージ配列の初回ロード完了後に、リストコンテナを最下部へスクロールする
- 以後のユーザー手動スクロールを上書きしない

**理由**:
- 「新しいメッセージが下」という UI 方針と一致する
- 毎レンダリングでスクロールを強制すると操作性を損なうため、初回のみ適用する

**代替案**:
- 常時オートスクロールは閲覧中の過去ログ確認を妨げるため不採用

### 5. レスポンシブは単一コンポーネント内で CSS 調整する

**決定**:
- 画面分岐を増やさず、`App.css` のメディアクエリで余白・フォント・行間を調整する

**理由**:
- Step 3 時点では UI 構造が単純で、コンポーネント分割よりも実装コストが低い
- 将来 Step 4 以降で機能追加しても差分を局所化しやすい

## Risks / Trade-offs

- **[Risk] メッセージ全件取得による性能劣化**
  - Mitigation: 将来対応としてページネーション/無限スクロールを追加する前提で、現段階では MVP 優先で全件取得を採用する

- **[Risk] URL 検出の誤判定（句読点や括弧を含むケース）**
  - Mitigation: Step 3 では基本パターンを対象とし、実運用で問題が出た場合にライブラリ導入を再検討する

- **[Trade-off] 初回のみ最下部スクロール**
  - 利点: 利用者の手動スクロールを妨げない
  - 欠点: 後続 Step で新規投稿をリアルタイム追加する際は追加のスクロール制御が必要になる
