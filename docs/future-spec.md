## アプリ仕様書

### 概要

**コンセプト**: 思いついたことを即座に書き留められる、手軽さ重視のメモアプリ

**対象ユーザー**: 個人利用（自分専用）

**対応環境**: スマホ・PCブラウザ（レスポンシブ対応）

---

### アーキテクチャ

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   Frontend      │      │    Backend      │      │    Database     │
│                 │      │                 │      │                 │
│  React SPA      │ ──── │  Go HTTP Server │ ──── │   PostgreSQL    │
│  (Cloudflare    │ HTTP │  (AWS App       │      │   (既存サーバー)  │
│   Workers)      │      │   Runner)       │      │                 │
└─────────────────┘      └─────────────────┘      └─────────────────┘
```

| レイヤー | 技術 | デプロイ先 |
|---------|------|-----------|
| フロントエンド | React | Cloudflare Workers |
| バックエンド | Go (HTTP サーバー) | AWS App Runner (Docker) |
| データベース | PostgreSQL | 本番: 既存サーバー / ローカル: Docker |

---

### データ設計

#### テーブル: `users`

| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| username | VARCHAR | ユーザー名（ログイン用） |
| password_hash | VARCHAR | ソルト付きハッシュ化パスワード |
| created_at | TIMESTAMP | 作成日時 |

#### テーブル: `sessions`

| カラム | 型 | 説明 |
|--------|-----|------|
| token | VARCHAR | 主キー（セッショントークン） |
| user_id | UUID (FK → users.id) | ユーザー |
| expires_at | TIMESTAMP | 有効期限（作成から30日後） |
| created_at | TIMESTAMP | 作成日時 |

#### テーブル: `messages`

| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | 主キー（連番） |
| user_id | UUID (FK → users.id) | 投稿者 |
| body | TEXT | 本文 |
| created_at | TIMESTAMP | 追加日時 |

---

### API 設計

#### 認証

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | `/api/login` | ログイン（セッション作成、Cookie発行） |
| POST | `/api/logout` | ログアウト（セッション削除、Cookie削除） |
| GET | `/api/me` | ログイン状態確認（任意） |

#### メッセージ（要認証）

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | `/api/messages` | メッセージ一覧取得（created_at 昇順、全件） |
| POST | `/api/messages` | メッセージ追加 |
| PUT | `/api/messages/:id` | メッセージ編集 |
| DELETE | `/api/messages/:id` | メッセージ削除 |

---

### 認証仕様

| 項目 | 内容 |
|------|------|
| 方式 | セッショントークンを Cookie に保存 |
| トークン形式 | ランダム文字列（例: 32バイトの hex） |
| 有効期限 | 30日間固定（自動延長なし） |
| Cookie 属性 | `HttpOnly`, `Secure`, `SameSite=Strict` 推奨 |
| ユーザー登録 | 画面なし。手動で DB に INSERT |

---

### 機能一覧

| 機能 | 詳細 |
|------|------|
| ログイン | ユーザー名 + パスワードで認証 |
| ログアウト | セッション破棄 |
| メッセージ追加 | テキストを入力して保存 |
| メッセージ編集 | 既存メッセージの本文を変更 |
| メッセージ削除 | 確認ダイアログ表示後に削除 |
| クリップボードコピー | メッセージ本文をコピー |
| デバイス間同期 | 同一ユーザーでログインすればデータ共有 |

---

### UI/UX

**表示形式**
- Slack風タイムライン（新しいメッセージが下）
- 日付の境目に区切りを表示

**テキスト処理**
- Markdown 非対応
- URL は自動リンク化（クリック可能）

**操作**
- 削除時は確認ダイアログを表示

---

### 将来対応（実装後に検討）

- メッセージ取得のページネーション / 無限スクロール

